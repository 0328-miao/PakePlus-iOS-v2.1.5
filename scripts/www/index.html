<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÊïôÂ∏àËØæÁ®ãË°®</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 12px 8px;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            padding: 12px;
            min-height: calc(100vh - 24px);
        }
        
        .header {
            background: linear-gradient(to right, #3a7bd5, #00d2ff);
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .date-info {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .week-type-display {
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .calendar-btn {
            background: none;
            border: none;
            font-size: 1rem;
            color: white;
            cursor: pointer;
            padding: 3px;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
        }
        
        .calendar-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .week-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        
        .week-nav-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            min-width: 75px;
        }
        
        .week-nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .week-nav-btn.current-week {
            background-color: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
        }
        
        .week-nav-btn.back-to-current {
            background-color: #ff9800;
        }
        
        .notes-search-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: flex-start;
            position: relative;
        }
        
        .notes-section {
            flex: 1;
            min-width: 0;
        }
        
        .notes-label {
            font-weight: 600;
            margin-bottom: 6px;
            color: #2c5282;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .notes-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 45px;
            background-color: #f8f9fa;
        }
        
        .search-section {
            width: 40px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .search-container {
            position: relative;
            width: 100%;
        }
        
        .search-toggle {
            background: #4a6fa5;
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            margin-bottom: 4px;
        }
        
        .search-toggle:hover {
            background: #3a5f95;
        }
        
        .search-box {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            overflow: hidden;
            transition: width 0.3s;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .search-box.active {
            width: 150px;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 36px 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.85rem;
            box-sizing: border-box;
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            pointer-events: none;
        }
        
        .search-results {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 8px;
            margin-top: 8px;
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            z-index: 1000;
            max-height: 60vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .search-result-item {
            padding: 8px 10px;
            margin-bottom: 6px;
            border-bottom: 1px dashed #ddd;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .search-result-item:hover {
            background-color: #ffeaa7;
        }
        
        .timetable {
            display: grid;
            grid-template-columns: 50px repeat(5, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            margin-bottom: 12px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .corner-cell {
            background-color: #4a6fa5;
            color: white;
            text-align: center;
            padding: 4px 2px;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 36px;
        }
        
        .weekday-cell {
            background-color: #4a6fa5;
            color: white;
            text-align: center;
            padding: 4px 2px;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .weekday-cell.selected {
            background-color: #3a5f95;
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.5);
        }
        
        .weekday-cell:hover {
            background-color: #3a5f95;
        }
        
        .time-slot {
            background-color: #f8f9fa;
            padding: 4px 2px;
            text-align: center;
            font-size: 0.65rem;
            color: #555;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-bottom: 1px solid #e0e0e0;
            min-height: 36px;
        }
        
        .time-label {
            font-weight: bold;
            color: #2c5282;
        }
        
        .time-edit {
            color: #888;
            font-size: 0.6rem;
            margin-top: 1px;
        }
        
        .course-cell {
            background-color: white;
            padding: 4px 2px;
            min-height: 36px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            user-select: none;
        }
        
        .course-cell:hover {
            background-color: #f0f7ff;
        }
        
        .course-content {
            font-size: 0.7rem;
            line-height: 1.1;
            text-align: center;
            width: 100%;
        }
        
        .course-subject {
            font-weight: 600;
            font-size: 0.75rem;
        }
        
        .course-details {
            color: #666;
            font-size: 0.65rem;
            margin-top: 1px;
        }
        
        .odd-week {
            border-left: 3px solid #00bcd4;
        }
        
        .even-week {
            border-left: 3px solid #4caf50;
        }
        
        /* Â≠ó‰ΩìÈ¢úËâ≤Ê†∑Âºè */
        .text-black { color: #000; }
        .text-red { color: #f44336; }
        .text-green { color: #4caf50; }
        
        .week-indicator {
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 0.55rem;
            padding: 1px 3px;
            border-radius: 2px;
            color: white;
            display: none;
        }
        
        .odd-indicator {
            background-color: #00bcd4;
        }
        
        .even-indicator {
            background-color: #4caf50;
        }
        
        .action-bar {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }
        
        .action-btn {
            flex: 1;
            min-width: 60px;
            padding: 8px 6px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .import-btn {
            background-color: #ff9800;
            color: white;
        }
        
        .export-btn {
            background-color: #4caf50;
            color: white;
        }
        
        .clear-btn {
            background-color: #f44336;
            color: white;
        }
        
        .time-btn {
            background-color: #9c27b0;
            color: white;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 380px;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2c5282;
        }
        
        .modal-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .save-options {
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .save-option {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .save-option:hover {
            background-color: #f0f7ff;
        }
        
        .save-option input[type="radio"] {
            margin-right: 8px;
        }
        
        .save-option.this-week {
            color: #ff5722;
            font-weight: 600;
        }
        
        .delete-options {
            margin: 10px 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .delete-option {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .delete-option:hover {
            background-color: #ffebee;
        }
        
        .delete-option input[type="radio"] {
            margin-right: 8px;
        }
        
        .delete-option.this-lesson {
            color: #f44336;
            font-weight: 600;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 16px;
        }
        
        .modal-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .modal-save {
            background-color: #4caf50;
            color: white;
        }
        
        .modal-delete {
            background-color: #f44336;
            color: white;
        }
        
        .modal-cancel {
            background-color: #9e9e9e;
            color: white;
        }
        
        .time-modal-content {
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .time-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 8px;
        }
        
        .time-input-group label {
            min-width: 45px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .time-input {
            flex: 1;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .data-list {
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
            display: none;
        }
        
        .data-list-item {
            padding: 6px 8px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .data-list-item:hover {
            background-color: #f0f7ff;
        }
        
        .history-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }
        
        .input-container {
            position: relative;
            margin-bottom: 8px;
        }
        
        .color-selector {
            display: flex;
            gap: 10px;
            margin: 8px 0;
        }
        
        .color-option {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-option:hover {
            background-color: #f0f7ff;
        }
        
        .color-option.selected {
            background-color: #e8f4ff;
            border: 2px solid #3a7bd5;
        }
        
        .color-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-bottom: 4px;
        }
        
        .color-black {
            background-color: #000;
        }
        
        .color-red {
            background-color: #f44336;
        }
        
        .color-green {
            background-color: #4caf50;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px 6px;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 10px;
            }
            
            .date-info {
                font-size: 1rem;
                justify-content: space-between;
            }
            
            .week-nav-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
                min-width: 70px;
            }
            
            .notes-search-row {
                flex-direction: row;
            }
            
            .search-section {
                width: 36px;
            }
            
            .search-toggle {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            
            .search-box.active {
                width: 140px;
            }
            
            .search-results {
                width: 95%;
                max-height: 50vh;
            }
            
            .timetable {
                grid-template-columns: 45px repeat(5, 1fr);
                max-height: 50vh;
            }
            
            .course-cell {
                min-height: 34px;
            }
            
            .action-btn {
                min-width: 55px;
                padding: 7px 5px;
                font-size: 0.75rem;
            }
            
            .notes-input {
                min-height: 40px;
                font-size: 0.8rem;
                padding: 6px;
            }
        }
        
        /* ‰ºòÂåñÊªöÂä®Êù°Ê†∑Âºè */
        .timetable::-webkit-scrollbar {
            width: 3px;
        }
        
        .timetable::-webkit-scrollbar-track {
            background: #f8f9fa;
        }
        
        .timetable::-webkit-scrollbar-thumb {
            background: #b0bec5;
            border-radius: 1px;
        }
        
        .timetable::-webkit-scrollbar-thumb:hover {
            background: #78909c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="date-info">
                <span id="currentDate">2025/12/27 Á¨¨18/25Âë®</span>
                <span class="week-type-display" id="weekTypeDisplay">ÂèåÂë®</span>
                <button class="calendar-btn" id="calendarBtn" title="ËÆæÁΩÆËµ∑ÂßãÊó•Êúü">
                    <i class="fas fa-calendar-alt"></i>
                </button>
            </div>
            <div class="week-nav">
                <button class="week-nav-btn" id="prevWeek">‰∏ä‰∏ÄÂë®</button>
                <button class="week-nav-btn current-week" id="currentWeek">Êú¨Âë®</button>
                <button class="week-nav-btn" id="nextWeek">‰∏ã‰∏ÄÂë®</button>
            </div>
        </div>
        
        <div class="timetable" id="timetable">
            <!-- Êó∂Èó¥Ë°®Â∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
        </div>
        
        <div class="notes-search-row">
            <div class="notes-section">
                <div class="notes-label">
                    <span id="currentNoteDay">Âë®ÂÖ≠ (12/27) ÂΩìÂ§©Â§áÊ≥®</span>
                </div>
                <label for="dailyNotes"></label><textarea class="notes-input" id="dailyNotes" placeholder="ËæìÂÖ•ÂΩìÂ§©ÁöÑÂ§áÊ≥®‰ø°ÊÅØ..."></textarea>
            </div>
            
            <div class="search-section">
                <div class="search-container">
                    <button class="search-toggle" id="searchToggle">üîç</button>
                    <div class="search-box" id="searchBox">
                        <label for="searchNotes"></label><input type="text" class="search-input" id="searchNotes" placeholder="ÊêúÁ¥¢Â§áÊ≥®...">
                        <span class="search-icon">üîç</span>
                    </div>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>
        </div>
        
        <div class="action-bar">
            <button class="action-btn import-btn" id="importBtn">ÂØºÂÖ•</button>
            <button class="action-btn export-btn" id="exportBtn">ÂØºÂá∫</button>
            <button class="action-btn clear-btn" id="clearBtn">Ê∏ÖÁ©∫</button>
            <button class="action-btn time-btn" id="timeBtn">Êó∂Èó¥</button>
        </div>
    </div>
    
    <!-- ËØæÁ®ãÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">ÁºñËæëËØæÁ®ã</div>
            
            <div class="input-container">
                <label for="courseSubject"></label><input type="text" class="modal-input" id="courseSubject" placeholder="ÁßëÁõÆ">
                <button class="history-btn" id="subjectHistoryBtn">‚ñº</button>
                <div class="data-list" id="subjectHistoryList"></div>
            </div>
            
            <div class="input-container">
                <label for="courseClass"></label><input type="text" class="modal-input" id="courseClass" placeholder="Áè≠Á∫ß">
                <button class="history-btn" id="classHistoryBtn">‚ñº</button>
                <div class="data-list" id="classHistoryList"></div>
            </div>
            
            <div class="input-container">
                <label for="courseRoom"></label><input type="text" class="modal-input" id="courseRoom" placeholder="ÊïôÂÆ§">
                <button class="history-btn" id="roomHistoryBtn">‚ñº</button>
                <div class="data-list" id="roomHistoryList"></div>
            </div>
            
            <!-- Â≠ó‰ΩìÈ¢úËâ≤ÈÄâÊã©Âô® -->
            <div class="color-selector">
                <div class="color-option" data-color="black">
                    <div class="color-dot color-black"></div>
                    <span style="font-size: 0.8rem;">ÈªëËâ≤</span>
                </div>
                <div class="color-option" data-color="red">
                    <div class="color-dot color-red"></div>
                    <span style="font-size: 0.8rem;">Á∫¢Ëâ≤</span>
                </div>
                <div class="color-option" data-color="green">
                    <div class="color-dot color-green"></div>
                    <span style="font-size: 0.8rem;">ÁªøËâ≤</span>
                </div>
            </div>
            
            <div class="save-options" id="saveOptions">
                <div class="save-option this-week">
                    <input type="radio" id="saveThisWeek" name="saveOption" value="thisWeek" checked>
                    <label for="saveThisWeek">‰ªÖ‰øùÂ≠òÂà∞Êú¨Âë®</label>
                </div>
                <div class="save-option">
                    <input type="radio" id="saveAllOdd" name="saveOption" value="allOdd">
                    <label for="saveAllOdd">‰øùÂ≠òÂà∞ÂÖ®ÈÉ®ÂçïÂë®</label>
                </div>
                <div class="save-option">
                    <input type="radio" id="saveAllEven" name="saveOption" value="allEven">
                    <label for="saveAllEven">‰øùÂ≠òÂà∞ÂÖ®ÈÉ®ÂèåÂë®</label>
                </div>
                <div class="save-option">
                    <input type="radio" id="saveAllWeeks" name="saveOption" value="allWeeks">
                    <label for="saveAllWeeks">‰øùÂ≠òÂà∞ÂÖ®ÈÉ®ÂçïÂèåÂë®</label>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="cancelCourse">ÂèñÊ∂à</button>
                <button class="modal-btn modal-save" id="saveCourse">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    
    <!-- ËØæÁ®ãÂà†Èô§Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">Âà†Èô§ËØæÁ®ã</div>
            
            <div class="delete-options">
                <div class="delete-option this-lesson">
                    <input type="radio" id="deleteThisLesson" name="deleteOption" value="thisLesson" checked>
                    <label for="deleteThisLesson">Âè™Âà†Èô§Êú¨ËäÇËØæ</label>
                </div>
                <div class="delete-option">
                    <input type="radio" id="deleteAllOdd" name="deleteOption" value="allOdd">
                    <label for="deleteAllOdd">Âà†Èô§Êú¨ËäÇÂÖ®ÈÉ®ÂçïÂë®</label>
                </div>
                <div class="delete-option">
                    <input type="radio" id="deleteAllEven" name="deleteOption" value="allEven">
                    <label for="deleteAllEven">Âà†Èô§Êú¨ËäÇÂÖ®ÈÉ®ÂèåÂë®</label>
                </div>
                <div class="delete-option">
                    <input type="radio" id="deleteAllWeeks" name="deleteOption" value="allWeeks">
                    <label for="deleteAllWeeks">Âà†Èô§Êú¨ËäÇÂÖ®ÈÉ®ÂçïÂèåÂë®</label>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="cancelDelete">ÂèñÊ∂à</button>
                <button class="modal-btn modal-delete" id="confirmDelete">Âà†Èô§</button>
            </div>
        </div>
    </div>
    
    <!-- Êó∂Èó¥ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="timeModal">
        <div class="modal-content time-modal-content">
            <div class="modal-header">ËÆæÁΩÆËØæÁ®ãÊó∂Èó¥</div>
            <div id="timeInputs">
                <!-- Êó∂Èó¥ËæìÂÖ•Ê°ÜÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="cancelTime">ÂèñÊ∂à</button>
                <button class="modal-btn modal-save" id="saveTime">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    
    <!-- Ëµ∑ÂßãÊó•ÊúüËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="startDateModal">
        <div class="modal-content">
            <div class="modal-header">ËÆæÁΩÆÂ≠¶ÊúüËµ∑ÂßãÊó•Êúü</div>
            <div style="margin-bottom: 12px;">
                <label for="startDateInput" style="display: block; margin-bottom: 6px; font-weight: 500;">ÈÄâÊã©Â≠¶ÊúüÂºÄÂßãÁöÑÊó•ÊúüÔºö</label>
                <input type="date" class="modal-input" id="startDateInput" value="2025-09-01">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="cancelStartDate">ÂèñÊ∂à</button>
                <button class="modal-btn modal-save" id="saveStartDate">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentWeek = 18;
        const totalWeeks = 25;
        let selectedCell = null;
        let selectedDay = -1;
        let currentWeekType = 'even';
        let isCurrentWeek = true;
        let searchResults = [];
        let currentDateData = {};
        let startDate = new Date('2025-09-01');
        let isSearchActive = false;
        let selectedColor = 'black';
        let longPressTimer = null;
        let isLongPress = false;
        
        // ÈªòËÆ§ËØæÁ®ãÊó∂Èó¥
        let classTimes = [
            "08:00-08:45",
            "08:55-09:40",
            "10:00-10:45",
            "11:00-11:45",
            "14:00-14:45",
            "15:00-15:45",
            "16:00-16:45"
        ];
        
        // ËØæÁ®ãÊï∞ÊçÆ
        let courseData = {};
        
        // Â§áÊ≥®Êï∞ÊçÆ
        let notesData = {};
        
        // ÂéÜÂè≤ËÆ∞ÂΩïÊï∞ÊçÆ
        let historyData = {
            subjects: [],
            classes: [],
            rooms: []
        };
        
        // ÂàùÂßãÂåñÂáΩÊï∞
        function init() {
            // ËÆæÁΩÆÂΩìÂâçÊó•Êúü
            updateCurrentDate();
            
            // ÁîüÊàêËØæÁ®ãË°®
            generateTimetable();
            
            // Âä†ËΩΩ‰øùÂ≠òÁöÑÊï∞ÊçÆ
            loadSavedData();
            
            // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
            setupEventListeners();
            
            // Ê∏ÖÁêÜÁé∞ÊúâÊó∂Èó¥Ê†ºÂºè
            cleanupTimeFormat();
        }
        
        // Ê∏ÖÁêÜÊó∂Èó¥Ê†ºÂºèÔºåÁßªÈô§ÂâçÂØºÂÜíÂè∑
        function cleanupTimeFormat() {
            // Ê∏ÖÁêÜclassTimesÊï∞ÁªÑ
            classTimes = classTimes.map(time => time.replace(/^:/, '').trim());
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            document.querySelectorAll('.time-slot').forEach((slot, index) => {
                const timeEdit = slot.querySelector('.time-edit');
                if (timeEdit && classTimes[index]) {
                    timeEdit.textContent = classTimes[index];
                }
            });
        }
        
        // Êõ¥Êñ∞ÂΩìÂâçÊó•ÊúüÊòæÁ§∫
        function updateCurrentDate() {
            const today = new Date();
            const todayDateStr = formatDate(today);
            
            // ËÆ°ÁÆóÂΩìÂâçÊòØÁ¨¨Âá†Âë®
            const calculatedWeek = calculateCurrentWeek();
            const currentDayOfWeek = today.getDay();
            
            // Â¶ÇÊûúÊòØÂë®Êú´ÔºåÊòæÁ§∫‰∏ãÂë®ÁöÑËØæÁ®ãË°®
            if (currentDayOfWeek === 0 || currentDayOfWeek === 6) {
                if (isCurrentWeek) {
                    currentWeek = calculatedWeek + 1;
                    if (currentWeek > totalWeeks) {
                        currentWeek = totalWeeks;
                    }
                }
                selectedDay = -1;
            } else {
                if (isCurrentWeek) {
                    currentWeek = calculatedWeek;
                }
                selectedDay = currentDayOfWeek - 1;
            }
            
            // Á°ÆÂÆöÂçïÂèåÂë®
            currentWeekType = currentWeek % 2 === 1 ? 'odd' : 'even';
            document.getElementById('weekTypeDisplay').textContent = currentWeekType === 'odd' ? 'ÂçïÂë®' : 'ÂèåÂë®';
            
            // Êõ¥Êñ∞Êó•ÊúüÊòæÁ§∫
            document.getElementById('currentDate').textContent = `${todayDateStr} Á¨¨${currentWeek}/${totalWeeks}Âë®`;
            
            // Êõ¥Êñ∞Âë®‰∏ÄÂà∞Âë®‰∫îÁöÑÊó•Êúü
            updateWeekdayDates();
            
            // Êõ¥Êñ∞ËØæÁ®ãË°®ÂçïÂèåÂë®ÊòæÁ§∫
            updateWeekTypeDisplay();
            
            // Êõ¥Êñ∞"Êú¨Âë®"ÊåâÈíÆÁä∂ÊÄÅ
            updateCurrentWeekButton();
            
            // Êõ¥Êñ∞Â§áÊ≥®Ê†áÈ¢ò
            updateNotesHeader();
        }
        
        // ËÆ°ÁÆóÂΩìÂâçÊó•ÊúüÂØπÂ∫îÁöÑÂë®Êï∞
        function calculateCurrentWeek() {
            const today = new Date();
            const timeDiff = today.getTime() - startDate.getTime();
            const dayDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
            let weekNumber = Math.floor(dayDiff / 7) + 1;
            
            weekNumber = Math.max(1, Math.min(weekNumber, totalWeeks));
            
            return weekNumber;
        }
        
        // Ê†ºÂºèÂåñÊó•Êúü‰∏∫YYYY/MM/DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }
        
        // Êõ¥Êñ∞Âë®Á±ªÂûãÊòæÁ§∫
        function updateWeekTypeDisplay() {
            document.getElementById('weekTypeDisplay').textContent = currentWeekType === 'odd' ? 'ÂçïÂë®' : 'ÂèåÂë®';
            
            document.querySelectorAll('.course-cell').forEach(cell => {
                cell.className = cell.className.replace('odd-week', '').replace('even-week', '').trim();
                cell.classList.add(currentWeekType === 'odd' ? 'odd-week' : 'even-week');
            });
        }
        
        // Êõ¥Êñ∞"Êú¨Âë®"ÊåâÈíÆÁä∂ÊÄÅ
        function updateCurrentWeekButton() {
            const currentWeekBtn = document.getElementById('currentWeek');
            const calculatedWeek = calculateCurrentWeek();
            const today = new Date();
            const currentDayOfWeek = today.getDay();
            
            let targetWeek = calculatedWeek;
            if (currentDayOfWeek === 0 || currentDayOfWeek === 6) {
                targetWeek = calculatedWeek + 1;
                if (targetWeek > totalWeeks) {
                    targetWeek = totalWeeks;
                }
            }
            
            if (currentWeek === targetWeek) {
                currentWeekBtn.textContent = 'Êú¨Âë®';
                currentWeekBtn.classList.remove('back-to-current');
                currentWeekBtn.classList.add('current-week');
                isCurrentWeek = true;
            } else {
                currentWeekBtn.textContent = 'ÂõûÂà∞Êú¨Âë®';
                currentWeekBtn.classList.remove('current-week');
                currentWeekBtn.classList.add('back-to-current');
                isCurrentWeek = false;
            }
        }
        
        // Êõ¥Êñ∞Â§áÊ≥®Ê†áÈ¢ò
        function updateNotesHeader() {
            const today = new Date();
            const currentDayOfWeek = today.getDay();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            
            let dayName = '';
            switch(currentDayOfWeek) {
                case 0: dayName = 'Âë®Êó•'; break;
                case 1: dayName = 'Âë®‰∏Ä'; break;
                case 2: dayName = 'Âë®‰∫å'; break;
                case 3: dayName = 'Âë®‰∏â'; break;
                case 4: dayName = 'Âë®Âõõ'; break;
                case 5: dayName = 'Âë®‰∫î'; break;
                case 6: dayName = 'Âë®ÂÖ≠'; break;
            }
            
            document.getElementById('currentNoteDay').textContent = `${dayName} (${month}/${day}) ÂΩìÂ§©Â§áÊ≥®`;
        }
        
        // Êõ¥Êñ∞Âë®‰∏ÄÂà∞Âë®‰∫îÁöÑÊó•Êúü
        function updateWeekdayDates() {
            // ËÆ°ÁÆóÁ¨¨‰∏ÄÂë®ÁöÑÂë®‰∏Ä
            const startDayOfWeek = startDate.getDay();
            const firstMonday = new Date(startDate);
            
            if (startDayOfWeek === 0) {
                firstMonday.setDate(startDate.getDate() - 6);
            } else {
                firstMonday.setDate(startDate.getDate() - (startDayOfWeek - 1));
            }
            
            // ËÆ°ÁÆóÂΩìÂâçÂë®ÁöÑÂë®‰∏Ä
            const currentWeekMonday = new Date(firstMonday);
            currentWeekMonday.setDate(firstMonday.getDate() + (currentWeek - 1) * 7);
            
            currentDateData = {};
            
            // Êõ¥Êñ∞Âë®‰∏ÄÂà∞Âë®‰∫îÁöÑÊó•ÊúüÊòæÁ§∫
            for (let i = 0; i < 5; i++) {
                const date = new Date(currentWeekMonday);
                date.setDate(currentWeekMonday.getDate() + i);
                
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                currentDateData[i] = { month, day, dateObj: date };
            }
            
            // Âä†ËΩΩÂΩìÂ§©ÁöÑÂ§áÊ≥®
            loadDailyNotes();
        }
        
        // ÁîüÊàêËØæÁ®ãË°®
        function generateTimetable() {
            const timetableDiv = document.getElementById('timetable');
            timetableDiv.innerHTML = '';
            
            // Á¨¨‰∏ÄË°åÁ¨¨‰∏Ä‰∏™Ê†ºÂ≠ê
            const cornerCell = document.createElement('div');
            cornerCell.className = 'corner-cell';
            cornerCell.innerHTML = 'ËäÇÊ¨°/ÊòüÊúü';
            timetableDiv.appendChild(cornerCell);
            
            // Á¨¨‰∏ÄË°åÁöÑÂë®‰∏ÄÂà∞Âë®‰∫îÊ†áÈ¢ò
            const weekdays = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î'];
            for (let j = 0; j < 5; j++) {
                const weekdayCell = document.createElement('div');
                weekdayCell.className = 'weekday-cell';
                
                const dateInfo = currentDateData[j] || { month: 12, day: 26 };
                const month = dateInfo.month || 12;
                const day = dateInfo.day || 26;
                
                weekdayCell.innerHTML = `${weekdays[j]}<br><span style="font-size:0.6rem">${month}/${day}</span>`;
                weekdayCell.dataset.day = j;
                
                // ÂàùÂßãÈÄâ‰∏≠Áä∂ÊÄÅ
                const today = new Date();
                const currentDayOfWeek = today.getDay();
                
                if (currentDayOfWeek >= 1 && currentDayOfWeek <= 5) {
                    if (j === currentDayOfWeek - 1) {
                        weekdayCell.classList.add('selected');
                    }
                } else {
                    if (j === 0) {
                        weekdayCell.classList.add('selected');
                    }
                }
                
                // ÁÇπÂáª‰∫ã‰ª∂
                weekdayCell.addEventListener('click', () => {
                    document.querySelectorAll('.weekday-cell').forEach(cell => {
                        cell.classList.remove('selected');
                    });
                    
                    weekdayCell.classList.add('selected');
                    selectedDay = j;
                    
                    const weekdays = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î'];
                    const dateInfo = currentDateData[j] || { month: 12, day: 26 };
                    const month = dateInfo.month || 12;
                    const day = dateInfo.day || 26;
                    document.getElementById('currentNoteDay').textContent = `${weekdays[j]} (${month}/${day}) ÂΩìÂ§©Â§áÊ≥®`;
                    
                    loadDailyNotes();
                });
                
                timetableDiv.appendChild(weekdayCell);
            }
            
            // ÁîüÊàêÊó∂Èó¥ÂàóÂíåËØæÁ®ãÂçïÂÖÉÊ†º
            for (let i = 0; i < 7; i++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.innerHTML = `
                    <div class="time-label">Á¨¨${i+1}ËäÇ</div>
                    <div class="time-edit">${classTimes[i]}</div>
                `;
                timetableDiv.appendChild(timeSlot);
                
                // ÁîüÊàêÊØèÂ§©ÁöÑËØæÁ®ãÂçïÂÖÉÊ†º
                for (let j = 0; j < 5; j++) {
                    const courseCell = document.createElement('div');
                    courseCell.className = `course-cell ${currentWeekType === 'odd' ? 'odd-week' : 'even-week'}`;
                    courseCell.dataset.day = j;
                    courseCell.dataset.slot = i;
                    
                    const courseContent = document.createElement('div');
                    courseContent.className = 'course-content';
                    courseCell.appendChild(courseContent);
                    
                    // ÁÇπÂáª‰∫ã‰ª∂ - Áü≠ÊåâÁºñËæë
                    courseCell.addEventListener('click', () => {
                        if (!isLongPress) {
                            selectedCell = courseCell;
                            const day = parseInt(selectedCell.dataset.day);
                            const slot = parseInt(selectedCell.dataset.slot);
                            openCourseEditor(day, slot);
                        }
                        isLongPress = false;
                    });
                    
                    // ÈïøÊåâ‰∫ã‰ª∂ - ÈïøÊåâÂà†Èô§
                    courseCell.addEventListener('mousedown', (e) => {
                        startLongPress(e, courseCell);
                    });
                    
                    courseCell.addEventListener('touchstart', (e) => {
                        startLongPress(e, courseCell);
                    });
                    
                    courseCell.addEventListener('mouseup', cancelLongPress);
                    courseCell.addEventListener('mouseleave', cancelLongPress);
                    courseCell.addEventListener('touchend', cancelLongPress);
                    courseCell.addEventListener('touchcancel', cancelLongPress);
                    
                    timetableDiv.appendChild(courseCell);
                }
            }
            
            updateCourseDisplay();
        }
        
        // ÂºÄÂßãÈïøÊåâ
        function startLongPress(e, cell) {
            isLongPress = false;
            longPressTimer = setTimeout(() => {
                isLongPress = true;
                selectedCell = cell;
                const day = parseInt(selectedCell.dataset.day);
                const slot = parseInt(selectedCell.dataset.slot);
                openDeleteModal(day, slot);
            }, 500);
        }
        
        // ÂèñÊ∂àÈïøÊåâ
        function cancelLongPress() {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }
        
        // ÊâìÂºÄËØæÁ®ãÁºñËæëÂô®
        function openCourseEditor(day, slot) {
            const modal = document.getElementById('courseModal');
            
            const weekdays = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î'];
            const dateInfo = currentDateData[day] || { month: 12, day: 26 };
            document.getElementById('modalHeader').textContent = `ÁºñËæëËØæÁ®ã - ${weekdays[day]} Á¨¨${slot+1}ËäÇ`;
            
            const currentWeekKey = `${currentWeek}_${day}_${slot}`;
            if (courseData[currentWeekKey]) {
                document.getElementById('courseSubject').value = courseData[currentWeekKey].subject || '';
                document.getElementById('courseClass').value = courseData[currentWeekKey].class || '';
                document.getElementById('courseRoom').value = courseData[currentWeekKey].room || '';
                
                selectedColor = courseData[currentWeekKey].color || 'black';
                updateColorSelector(selectedColor);
            } else {
                document.getElementById('courseSubject').value = '';
                document.getElementById('courseClass').value = '';
                document.getElementById('courseRoom').value = '';
                selectedColor = 'black';
                updateColorSelector('black');
            }
            
            document.getElementById('saveThisWeek').checked = true;
            
            loadHistoryLists();
            
            modal.style.display = 'flex';
        }
        
        // ÊâìÂºÄÂà†Èô§Ê®°ÊÄÅÊ°Ü
        function openDeleteModal(day, slot) {
            const modal = document.getElementById('deleteModal');
            document.getElementById('deleteThisLesson').checked = true;
            modal.style.display = 'flex';
        }
        
        // Êõ¥Êñ∞È¢úËâ≤ÈÄâÊã©Âô®
        function updateColorSelector(color) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.color === color) {
                    option.classList.add('selected');
                }
            });
        }
        
        // ‰øùÂ≠òËØæÁ®ã
        function saveCourse() {
            if (!selectedCell) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÁºñËæëÁöÑËØæÁ®ãÂçïÂÖÉÊ†º');
                return;
            }
            
            const day = parseInt(selectedCell.dataset.day);
            const slot = parseInt(selectedCell.dataset.slot);
            const subject = document.getElementById('courseSubject').value.trim();
            const classVal = document.getElementById('courseClass').value.trim();
            const room = document.getElementById('courseRoom').value.trim();
            
            const saveOption = document.querySelector('input[name="saveOption"]:checked').value;
            
            if (saveOption === 'thisWeek') {
                const courseKey = `${currentWeek}_${day}_${slot}`;
                if (subject || classVal || room) {
                    courseData[courseKey] = { 
                        subject, 
                        class: classVal, 
                        room,
                        color: selectedColor,
                        saveType: 'thisWeek'
                    };
                    
                    addToHistory('subjects', subject);
                    addToHistory('classes', classVal);
                    addToHistory('rooms', room);
                } else {
                    delete courseData[courseKey];
                }
            } else if (saveOption === 'allOdd') {
                for (let week = 1; week <= totalWeeks; week += 2) {
                    const courseKey = `${week}_${day}_${slot}`;
                    if (subject || classVal || room) {
                        courseData[courseKey] = { 
                            subject, 
                            class: classVal, 
                            room,
                            color: selectedColor,
                            saveType: 'allOdd'
                        };
                    } else {
                        delete courseData[courseKey];
                    }
                }
                if (subject || classVal || room) {
                    addToHistory('subjects', subject);
                    addToHistory('classes', classVal);
                    addToHistory('rooms', room);
                }
            } else if (saveOption === 'allEven') {
                for (let week = 2; week <= totalWeeks; week += 2) {
                    const courseKey = `${week}_${day}_${slot}`;
                    if (subject || classVal || room) {
                        courseData[courseKey] = { 
                            subject, 
                            class: classVal, 
                            room,
                            color: selectedColor,
                            saveType: 'allEven'
                        };
                    } else {
                        delete courseData[courseKey];
                    }
                }
                if (subject || classVal || room) {
                    addToHistory('subjects', subject);
                    addToHistory('classes', classVal);
                    addToHistory('rooms', room);
                }
            } else if (saveOption === 'allWeeks') {
                for (let week = 1; week <= totalWeeks; week++) {
                    const courseKey = `${week}_${day}_${slot}`;
                    if (subject || classVal || room) {
                        courseData[courseKey] = { 
                            subject, 
                            class: classVal, 
                            room,
                            color: selectedColor,
                            saveType: 'allWeeks'
                        };
                    } else {
                        delete courseData[courseKey];
                    }
                }
                if (subject || classVal || room) {
                    addToHistory('subjects', subject);
                    addToHistory('classes', classVal);
                    addToHistory('rooms', room);
                }
            }
            
            updateCourseDisplay();
            saveData();
            closeCourseEditor();
        }
        
        // Âà†Èô§ËØæÁ®ã
        function deleteCourse() {
            if (!selectedCell) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑËØæÁ®ãÂçïÂÖÉÊ†º');
                return;
            }
            
            const day = parseInt(selectedCell.dataset.day);
            const slot = parseInt(selectedCell.dataset.slot);
            
            const deleteOption = document.querySelector('input[name="deleteOption"]:checked').value;
            
            if (deleteOption === 'thisLesson') {
                const courseKey = `${currentWeek}_${day}_${slot}`;
                delete courseData[courseKey];
            } else if (deleteOption === 'allOdd') {
                for (let week = 1; week <= totalWeeks; week += 2) {
                    const courseKey = `${week}_${day}_${slot}`;
                    delete courseData[courseKey];
                }
            } else if (deleteOption === 'allEven') {
                for (let week = 2; week <= totalWeeks; week += 2) {
                    const courseKey = `${week}_${day}_${slot}`;
                    delete courseData[courseKey];
                }
            } else if (deleteOption === 'allWeeks') {
                for (let week = 1; week <= totalWeeks; week++) {
                    const courseKey = `${week}_${day}_${slot}`;
                    delete courseData[courseKey];
                }
            }
            
            updateCourseDisplay();
            saveData();
            closeDeleteModal();
        }
        
        // ÂÖ≥Èó≠ËØæÁ®ãÁºñËæëÂô®
        function closeCourseEditor() {
            document.getElementById('courseModal').style.display = 'none';
            selectedCell = null;
        }
        
        // ÂÖ≥Èó≠Âà†Èô§Ê®°ÊÄÅÊ°Ü
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            selectedCell = null;
        }
        
        // Êõ¥Êñ∞ËØæÁ®ãÊòæÁ§∫
        function updateCourseDisplay() {
            const courseCells = document.querySelectorAll('.course-cell');
            
            courseCells.forEach(cell => {
                const day = parseInt(cell.dataset.day);
                const slot = parseInt(cell.dataset.slot);
                const courseKey = `${currentWeek}_${day}_${slot}`;
                
                let courseContent = cell.querySelector('.course-content');
                if (!courseContent) {
                    courseContent = document.createElement('div');
                    courseContent.className = 'course-content';
                    cell.appendChild(courseContent);
                }
                
                courseContent.innerHTML = '';
                
                if (courseData[courseKey]) {
                    const course = courseData[courseKey];
                    
                    if (course.subject) {
                        const subjectDiv = document.createElement('div');
                        subjectDiv.className = 'course-subject';
                        subjectDiv.textContent = course.subject;
                        subjectDiv.classList.add(`text-${course.color || 'black'}`);
                        courseContent.appendChild(subjectDiv);
                    }
                    
                    if (course.class || course.room) {
                        const detailsDiv = document.createElement('div');
                        detailsDiv.className = 'course-details';
                        detailsDiv.textContent = `${course.class || ''} ${course.room || ''}`;
                        courseContent.appendChild(detailsDiv);
                    }
                }
                
                cell.className = 'course-cell';
                if (currentWeek % 2 === 1) {
                    cell.classList.add('odd-week');
                } else {
                    cell.classList.add('even-week');
                }
            });
        }
        
        // ÊâìÂºÄÊó∂Èó¥ËÆæÁΩÆ
        function openTimeSettings() {
            const modal = document.getElementById('timeModal');
            const timeInputsDiv = document.getElementById('timeInputs');
            timeInputsDiv.innerHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const timeInputGroup = document.createElement('div');
                timeInputGroup.className = 'time-input-group';
                timeInputGroup.innerHTML = `
                    <label for="time-${i}">Á¨¨${i+1}ËäÇ:</label>
                    <input type="text" class="time-input" id="time-${i}" value="${classTimes[i]}" placeholder="‰æãÂ¶Ç: 08:00-08:45">
                `;
                timeInputsDiv.appendChild(timeInputGroup);
            }
            
            modal.style.display = 'flex';
        }
        
        // ‰øùÂ≠òÊó∂Èó¥ËÆæÁΩÆ
        function saveTimeSettings() {
            for (let i = 0; i < 7; i++) {
                const timeInput = document.getElementById(`time-${i}`);
                let timeValue = timeInput.value.trim();
                if (timeValue.startsWith(':')) {
                    timeValue = timeValue.substring(1).trim();
                }
                classTimes[i] = timeValue;
            }
            
            document.querySelectorAll('.time-slot').forEach((slot, index) => {
                const timeEdit = slot.querySelector('.time-edit');
                if (timeEdit && classTimes[index]) {
                    timeEdit.textContent = classTimes[index].replace(/^:/, '');
                }
            });
            
            saveData();
            closeTimeSettings();
        }
        
        // ÂÖ≥Èó≠Êó∂Èó¥ËÆæÁΩÆ
        function closeTimeSettings() {
            document.getElementById('timeModal').style.display = 'none';
        }
        
        // ÊâìÂºÄËµ∑ÂßãÊó•ÊúüËÆæÁΩÆ
        function openStartDateModal() {
            const modal = document.getElementById('startDateModal');
            document.getElementById('startDateInput').value = formatDateForInput(startDate);
            modal.style.display = 'flex';
        }
        
        // ‰øùÂ≠òËµ∑ÂßãÊó•Êúü
        function saveStartDate() {
            const dateInput = document.getElementById('startDateInput').value;
            if (dateInput) {
                startDate = new Date(dateInput);
                updateCurrentDate();
                updateWeekDisplay();
                saveData();
            }
            closeStartDateModal();
        }
        
        // ÂÖ≥Èó≠Ëµ∑ÂßãÊó•ÊúüËÆæÁΩÆ
        function closeStartDateModal() {
            document.getElementById('startDateModal').style.display = 'none';
        }
        
        // Ê†ºÂºèÂåñÊó•Êúü‰∏∫YYYY-MM-DDÊ†ºÂºè
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // ÂàáÊç¢ÊêúÁ¥¢Ê°ÜÊòæÁ§∫
        function toggleSearchBox() {
            const searchBox = document.getElementById('searchBox');
            const searchInput = document.getElementById('searchNotes');
            
            if (isSearchActive) {
                searchBox.classList.remove('active');
                searchInput.blur();
                hideSearchResults();
            } else {
                searchBox.classList.add('active');
                setTimeout(() => {
                    searchInput.focus();
                }, 100);
            }
            
            isSearchActive = !isSearchActive;
        }
        
        // ÈöêËóèÊêúÁ¥¢ÁªìÊûú
        function hideSearchResults() {
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.style.display = 'none';
        }
        
        // Âä†ËΩΩÂΩìÂ§©ÁöÑÂ§áÊ≥®
        function loadDailyNotes() {
            const today = new Date();
            const currentDayOfWeek = today.getDay();
            
            let noteKey;
            if (selectedDay === -1) {
                noteKey = `notes-${currentWeek}-weekend-${currentDayOfWeek}`;
            } else {
                noteKey = `notes-${currentWeek}-${selectedDay}`;
            }
            
            document.getElementById('dailyNotes').value = notesData[noteKey] || '';
        }
        
        // ‰øùÂ≠òÂΩìÂ§©ÁöÑÂ§áÊ≥®
        function saveDailyNotes() {
            const today = new Date();
            const currentDayOfWeek = today.getDay();
            
            let noteKey;
            if (selectedDay === -1) {
                noteKey = `notes-${currentWeek}-weekend-${currentDayOfWeek}`;
            } else {
                noteKey = `notes-${currentWeek}-${selectedDay}`;
            }
            
            const notes = document.getElementById('dailyNotes').value.trim();
            
            if (notes) {
                notesData[noteKey] = notes;
            } else {
                delete notesData[noteKey];
            }
            
            saveData();
        }
        
        // ÊêúÁ¥¢Â§áÊ≥®
        function searchNotes() {
            const searchTerm = document.getElementById('searchNotes').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchTerm) {
                resultsDiv.style.display = 'none';
                resultsDiv.innerHTML = '';
                return;
            }
            
            searchResults = [];
            
            for (let week = 1; week <= totalWeeks; week++) {
                for (let day = 0; day < 5; day++) {
                    const noteKey = `notes-${week}-${day}`;
                    if (notesData[noteKey] && notesData[noteKey].toLowerCase().includes(searchTerm)) {
                        const weekdays = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î'];
                        
                        const weekStart = new Date(startDate);
                        weekStart.setDate(startDate.getDate() + (week - 1) * 7);
                        
                        const weekMonday = new Date(weekStart);
                        weekMonday.setDate(weekStart.getDate() - (weekStart.getDay() === 0 ? 6 : weekStart.getDay() - 1));
                        
                        const specificDate = new Date(weekMonday);
                        specificDate.setDate(weekMonday.getDate() + day);
                        
                        const month = specificDate.getMonth() + 1;
                        const dayOfMonth = specificDate.getDate();
                        
                        searchResults.push({
                            week: week,
                            day: day,
                            dayName: weekdays[day],
                            month: month,
                            dayOfMonth: dayOfMonth,
                            notes: notesData[noteKey]
                        });
                    }
                }
                
                for (let weekendDay = 0; weekendDay <= 6; weekendDay++) {
                    if (weekendDay === 0 || weekendDay === 6) {
                        const noteKey = `notes-${week}-weekend-${weekendDay}`;
                        if (notesData[noteKey] && notesData[noteKey].toLowerCase().includes(searchTerm)) {
                            const dayName = weekendDay === 0 ? 'Âë®Êó•' : 'Âë®ÂÖ≠';
                            
                            const weekStart = new Date(startDate);
                            weekStart.setDate(startDate.getDate() + (week - 1) * 7);
                            
                            const weekMonday = new Date(weekStart);
                            weekMonday.setDate(weekStart.getDate() - (weekStart.getDay() === 0 ? 6 : weekStart.getDay() - 1));
                            
                            const specificDate = new Date(weekMonday);
                            specificDate.setDate(weekMonday.getDate() + (weekendDay === 6 ? 5 : 6));
                            
                            const month = specificDate.getMonth() + 1;
                            const dayOfMonth = specificDate.getDate();
                            
                            searchResults.push({
                                week: week,
                                day: weekendDay === 6 ? 5 : 6,
                                dayName: dayName,
                                month: month,
                                dayOfMonth: dayOfMonth,
                                notes: notesData[noteKey]
                            });
                        }
                    }
                }
            }
            
            if (searchResults.length > 0) {
                resultsDiv.innerHTML = '<strong>ÊêúÁ¥¢ÁªìÊûúÔºö</strong>';
                
                searchResults.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.innerHTML = `<strong>Á¨¨${result.week}Âë® ${result.dayName} (${result.month}/${result.dayOfMonth})</strong><br>${result.notes.substring(0, 30)}${result.notes.length > 30 ? '...' : ''}`;
                    resultItem.dataset.week = result.week;
                    resultItem.dataset.day = result.day;
                    
                    resultItem.addEventListener('click', () => {
                        currentWeek = result.week;
                        
                        if (result.day >= 0 && result.day <= 4) {
                            selectedDay = result.day;
                            isCurrentWeek = false;
                        } else {
                            selectedDay = -1;
                            isCurrentWeek = true;
                        }
                        
                        updateWeekDisplay();
                        
                        resultsDiv.style.display = 'none';
                        document.getElementById('searchNotes').value = '';
                        toggleSearchBox();
                    });
                    
                    resultsDiv.appendChild(resultItem);
                });
                
                resultsDiv.style.display = 'block';
            } else {
                resultsDiv.innerHTML = '<div>Êú™ÊâæÂà∞ÂåÖÂê´ËØ•ÂÖ≥ÈîÆËØçÁöÑÂ§áÊ≥®„ÄÇ</div>';
                resultsDiv.style.display = 'block';
            }
        }
        
        // Ê∏ÖÁ©∫ËØæÁ®ãË°®
        function clearTimetable() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫Êï¥‰∏™ËØæÁ®ãË°®ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                courseData = {};
                updateCourseDisplay();
                saveData();
            }
        }
        
        // ÂØºÂá∫Êï∞ÊçÆ
        function exportData() {
            const exportData = {
                classTimes: classTimes,
                courses: {}
            };
            
            for (const key in courseData) {
                if (courseData.hasOwnProperty(key)) {
                    exportData.courses[key] = courseData[key];
                }
            }
            
            let txtContent = "ÊïôÂ∏àËØæÁ®ãË°®Êï∞ÊçÆ\n";
            txtContent += "================\n\n";
            txtContent += "ËØæÁ®ãÊó∂Èó¥ÂÆâÊéí:\n";
            classTimes.forEach((time, index) => {
                const cleanTime = time.replace(/^:/, '');
                txtContent += `Á¨¨${index+1}ËäÇ: ${cleanTime}\n`;
            });
            
            txtContent += "\nËØæÁ®ãÂÆâÊéí:\n";
            const days = ['Âë®‰∏Ä', 'Âë®‰∫å', 'Âë®‰∏â', 'Âë®Âõõ', 'Âë®‰∫î'];
            for (let day = 0; day < 5; day++) {
                for (let slot = 0; slot < 7; slot++) {
                    let hasOddWeek = false;
                    let hasEvenWeek = false;
                    let oddWeekData = null;
                    let evenWeekData = null;
                    
                    for (let week = 1; week <= totalWeeks; week++) {
                        const courseKey = `${week}_${day}_${slot}`;
                        if (courseData[courseKey]) {
                            if (week % 2 === 1) {
                                hasOddWeek = true;
                                oddWeekData = courseData[courseKey];
                            } else {
                                hasEvenWeek = true;
                                evenWeekData = courseData[courseKey];
                            }
                        }
                    }
                    
                    if (hasOddWeek || hasEvenWeek) {
                        txtContent += `${days[day]} Á¨¨${slot+1}ËäÇ:\n`;
                        
                        if (hasOddWeek && oddWeekData) {
                            txtContent += `  ÂçïÂë®: ${oddWeekData.subject || ''} | ${oddWeekData.class || ''} | ${oddWeekData.room || ''}\n`;
                        }
                        
                        if (hasEvenWeek && evenWeekData) {
                            txtContent += `  ÂèåÂë®: ${evenWeekData.subject || ''} | ${oddWeekData.class || ''} | ${oddWeekData.room || ''}\n`;
                        }
                    }
                }
            }
            
            try {
                const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ËØæÁ®ãË°®_${new Date().toLocaleDateString('zh-CN')}.txt`;
                document.body.appendChild(a);
                
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                a.dispatchEvent(clickEvent);
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
            } catch (error) {
                console.error('ÂØºÂá∫Â§±Ë¥•:', error);
                alert('ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑Â§çÂà∂‰ª•‰∏ãÊñáÊú¨‰øùÂ≠ò‰∏∫.txtÊñá‰ª∂Ôºö\n\n' + txtContent);
            }
        }
        
        // ÂØºÂÖ•Êï∞ÊçÆ
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.style.display = 'none';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const content = event.target.result;
                        const lines = content.split('\n');
                        let parsingTimes = false;
                        let parsingCourses = false;
                        let currentDay = -1;
                        let currentSlot = -1;
                        
                        const importedCourseData = {};
                        const importedClassTimes = [...classTimes];
                        
                        const dayMap = {
                            'Âë®‰∏Ä': 0,
                            'Âë®‰∫å': 1,
                            'Âë®‰∏â': 2,
                            'Âë®Âõõ': 3,
                            'Âë®‰∫î': 4
                        };
                        
                        for (let i = 0; i < lines.length; i++) {
                            const line = lines[i].trim();
                            
                            if (line === "ËØæÁ®ãÊó∂Èó¥ÂÆâÊéí:" || line === "ËØæÁ®ãÊó∂Èó¥ÂÆâÊéí") {
                                parsingTimes = true;
                                parsingCourses = false;
                                continue;
                            } else if (line === "ËØæÁ®ãÂÆâÊéí:" || line === "ËØæÁ®ãÂÆâÊéí") {
                                parsingTimes = false;
                                parsingCourses = true;
                                continue;
                            } else if (line.startsWith("ÊïôÂ∏àËØæÁ®ãË°®Êï∞ÊçÆ") || line.startsWith("===") || line === "") {
                                continue;
                            }
                            
                            if (parsingTimes && line.startsWith("Á¨¨")) {
                                const match = line.match(/Á¨¨\s*(\d+)\s*[ËäÇ:]?\s*(.+)/);
                                if (match) {
                                    const slot = parseInt(match[1]) - 1;
                                    const time = match[2].trim();
                                    if (slot >= 0 && slot < 7) {
                                        importedClassTimes[slot] = time;
                                    }
                                }
                            } else if (parsingCourses) {
                                const dayMatch = line.match(/(Âë®‰∏Ä|Âë®‰∫å|Âë®‰∏â|Âë®Âõõ|Âë®‰∫î)\s*Á¨¨\s*(\d+)\s*[ËäÇ:]/);
                                if (dayMatch) {
                                    currentDay = dayMap[dayMatch[1]];
                                    currentSlot = parseInt(dayMatch[2]) - 1;
                                    continue;
                                }
                                
                                if (line.includes("ÂçïÂë®:") || line.includes("ÂèåÂë®:")) {
                                    const isOdd = line.includes("ÂçïÂë®:");
                                    const prefix = isOdd ? "ÂçïÂë®:" : "ÂèåÂë®:";
                                    const courseInfoStr = line.substring(line.indexOf(prefix) + prefix.length).trim();
                                    
                                    if (currentDay !== -1 && currentSlot !== -1 && courseInfoStr) {
                                        const courseInfo = courseInfoStr.split('|').map(s => s.trim());
                                        
                                        if (isOdd) {
                                            for (let week = 1; week <= totalWeeks; week += 2) {
                                                const courseKey = `${week}_${currentDay}_${currentSlot}`;
                                                importedCourseData[courseKey] = {
                                                    subject: courseInfo[0] || '',
                                                    class: courseInfo[1] || '',
                                                    room: courseInfo[2] || '',
                                                    color: 'black',
                                                    saveType: 'allOdd'
                                                };
                                            }
                                        } else {
                                            for (let week = 2; week <= totalWeeks; week += 2) {
                                                const courseKey = `${week}_${currentDay}_${currentSlot}`;
                                                importedCourseData[courseKey] = {
                                                    subject: courseInfo[0] || '',
                                                    class: courseInfo[1] || '',
                                                    room: courseInfo[2] || '',
                                                    color: 'black',
                                                    saveType: 'allEven'
                                                };
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        Object.assign(courseData, importedCourseData);
                        classTimes = importedClassTimes;
                        
                        updateCourseDisplay();
                        
                        document.querySelectorAll('.time-slot').forEach((slot, index) => {
                            const timeEdit = slot.querySelector('.time-edit');
                            if (timeEdit && classTimes[index]) {
                                timeEdit.textContent = classTimes[index];
                            }
                        });
                        
                        saveData();
                        
                        alert('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                    } catch (error) {
                        console.error('ÂØºÂÖ•Â§±Ë¥•:', error);
                        alert('ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°Æ„ÄÇËØ∑Á°Æ‰øùÊñá‰ª∂Ê†ºÂºèÊ≠£Á°Æ„ÄÇ');
                    }
                    
                    document.body.removeChild(input);
                };
                
                reader.onerror = function(event) {
                    console.error('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•:', event.target.error);
                    alert('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ');
                    document.body.removeChild(input);
                };
                
                reader.readAsText(file, 'UTF-8');
            };
            
            document.body.appendChild(input);
            
            setTimeout(() => {
                try {
                    input.click();
                } catch (error) {
                    console.error('Ëß¶ÂèëÊñá‰ª∂ÈÄâÊã©Â§±Ë¥•:', error);
                    alert('Êñá‰ª∂ÈÄâÊã©Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊµèËßàÂô®ÊùÉÈôêËÆæÁΩÆ„ÄÇ');
                    document.body.removeChild(input);
                }
            }, 100);
        }
        
        // ‰øùÂ≠òÊï∞ÊçÆÂà∞Êú¨Âú∞
        function saveData() {
            const data = {
                courseData,
                notesData,
                classTimes,
                historyData,
                currentWeek,
                currentWeekType,
                startDate: startDate.toISOString().split('T')[0]
            };
            
            localStorage.setItem('teacherTimetable', JSON.stringify(data));
        }
        
        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆ
        function loadSavedData() {
            const savedData = localStorage.getItem('teacherTimetable');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    if (data.courseData) courseData = data.courseData;
                    if (data.notesData) notesData = data.notesData;
                    if (data.classTimes) classTimes = data.classTimes;
                    if (data.historyData) historyData = data.historyData;
                    if (data.currentWeek) currentWeek = data.currentWeek;
                    if (data.currentWeekType) currentWeekType = data.currentWeekType;
                    if (data.startDate) startDate = new Date(data.startDate);
                    
                    updateCourseDisplay();
                    loadDailyNotes();
                    updateWeekTypeDisplay();
                } catch (error) {
                    console.error('Âä†ËΩΩÊú¨Âú∞Êï∞ÊçÆÊó∂Âá∫Èîô:', error);
                }
            }
        }
        
        // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
        function addToHistory(type, value) {
            if (!value) return;
            
            if (!historyData[type].includes(value)) {
                historyData[type].unshift(value);
                
                if (historyData[type].length > 10) {
                    historyData[type] = historyData[type].slice(0, 10);
                }
                
                saveData();
            }
        }
        
        // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
        function loadHistoryLists() {
            const subjectList = document.getElementById('subjectHistoryList');
            subjectList.innerHTML = '';
            historyData.subjects.forEach(subject => {
                if (subject) {
                    const item = document.createElement('div');
                    item.className = 'data-list-item';
                    item.textContent = subject;
                    item.addEventListener('click', () => {
                        document.getElementById('courseSubject').value = subject;
                        subjectList.style.display = 'none';
                    });
                    subjectList.appendChild(item);
                }
            });
            
            const classList = document.getElementById('classHistoryList');
            classList.innerHTML = '';
            historyData.classes.forEach(className => {
                if (className) {
                    const item = document.createElement('div');
                    item.className = 'data-list-item';
                    item.textContent = className;
                    item.addEventListener('click', () => {
                        document.getElementById('courseClass').value = className;
                        classList.style.display = 'none';
                    });
                    classList.appendChild(item);
                }
            });
            
            const roomList = document.getElementById('roomHistoryList');
            roomList.innerHTML = '';
            historyData.rooms.forEach(room => {
                if (room) {
                    const item = document.createElement('div');
                    item.className = 'data-list-item';
                    item.textContent = room;
                    item.addEventListener('click', () => {
                        document.getElementById('courseRoom').value = room;
                        roomList.style.display = 'none';
                    });
                    roomList.appendChild(item);
                }
            });
        }
        
        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            document.getElementById('importBtn').addEventListener('click', importData);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('clearBtn').addEventListener('click', clearTimetable);
            document.getElementById('timeBtn').addEventListener('click', openTimeSettings);
            document.getElementById('calendarBtn').addEventListener('click', openStartDateModal);
            document.getElementById('searchToggle').addEventListener('click', toggleSearchBox);
            
            document.getElementById('searchNotes').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchNotes();
                }
            });
            
            document.addEventListener('click', function(e) {
                const searchContainer = document.querySelector('.search-container');
                const searchBox = document.getElementById('searchBox');
                const searchToggle = document.getElementById('searchToggle');
                
                if (isSearchActive && !searchContainer.contains(e.target) && e.target !== searchToggle) {
                    toggleSearchBox();
                }
            });
            
            document.getElementById('prevWeek').addEventListener('click', () => {
                if (currentWeek > 1) {
                    currentWeek--;
                    isCurrentWeek = false;
                    currentWeekType = currentWeek % 2 === 1 ? 'odd' : 'even';
                    updateWeekDisplay();
                }
            });
            
            document.getElementById('currentWeek').addEventListener('click', () => {
                const today = new Date();
                const calculatedWeek = calculateCurrentWeek();
                const currentDayOfWeek = today.getDay();
                
                if (currentDayOfWeek === 0 || currentDayOfWeek === 6) {
                    currentWeek = calculatedWeek + 1;
                    if (currentWeek > totalWeeks) {
                        currentWeek = totalWeeks;
                    }
                    selectedDay = -1;
                } else {
                    currentWeek = calculatedWeek;
                    selectedDay = currentDayOfWeek - 1;
                }
                
                isCurrentWeek = true;
                updateCurrentDate();
                updateWeekDisplay();
            });
            
            document.getElementById('nextWeek').addEventListener('click', () => {
                if (currentWeek < totalWeeks) {
                    currentWeek++;
                    isCurrentWeek = false;
                    currentWeekType = currentWeek % 2 === 1 ? 'odd' : 'even';
                    updateWeekDisplay();
                }
            });
            
            document.getElementById('dailyNotes').addEventListener('blur', saveDailyNotes);
            
            document.getElementById('saveCourse').addEventListener('click', function(e) {
                e.preventDefault();
                saveCourse();
            });
            
            document.getElementById('cancelCourse').addEventListener('click', closeCourseEditor);
            
            document.getElementById('confirmDelete').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËØæÁ®ãÂêóÔºü')) {
                    deleteCourse();
                }
            });
            
            document.getElementById('cancelDelete').addEventListener('click', closeDeleteModal);
            
            document.getElementById('saveTime').addEventListener('click', saveTimeSettings);
            document.getElementById('cancelTime').addEventListener('click', closeTimeSettings);
            
            document.getElementById('saveStartDate').addEventListener('click', saveStartDate);
            document.getElementById('cancelStartDate').addEventListener('click', closeStartDateModal);
            
            window.addEventListener('click', function(event) {
                const courseModal = document.getElementById('courseModal');
                const deleteModal = document.getElementById('deleteModal');
                const timeModal = document.getElementById('timeModal');
                const startDateModal = document.getElementById('startDateModal');
                
                if (event.target === courseModal) {
                    closeCourseEditor();
                }
                
                if (event.target === deleteModal) {
                    closeDeleteModal();
                }
                
                if (event.target === timeModal) {
                    closeTimeSettings();
                }
                
                if (event.target === startDateModal) {
                    closeStartDateModal();
                }
            });
            
            document.getElementById('subjectHistoryBtn').addEventListener('click', function() {
                const list = document.getElementById('subjectHistoryList');
                list.style.display = list.style.display === 'block' ? 'none' : 'block';
            });
            
            document.getElementById('classHistoryBtn').addEventListener('click', function() {
                const list = document.getElementById('classHistoryList');
                list.style.display = list.style.display === 'block' ? 'none' : 'block';
            });
            
            document.getElementById('roomHistoryBtn').addEventListener('click', function() {
                const list = document.getElementById('roomHistoryList');
                list.style.display = list.style.display === 'block' ? 'none' : 'block';
            });
            
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.input-container')) {
                    document.querySelectorAll('.data-list').forEach(list => {
                        list.style.display = 'none';
                    });
                }
            });
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectedColor = this.dataset.color;
                    updateColorSelector(selectedColor);
                });
            });
        }
        
        // Êõ¥Êñ∞Âë®ÊòæÁ§∫
        function updateWeekDisplay() {
            const today = new Date();
            const dateStr = formatDate(today);
            document.getElementById('currentDate').textContent = `${dateStr} Á¨¨${currentWeek}/${totalWeeks}Âë®`;
            
            updateWeekTypeDisplay();
            updateWeekdayDates();
            generateTimetable();
            updateCurrentWeekButton();
            updateNotesHeader();
        }
        
        // ÂàùÂßãÂåñÂ∫îÁî®
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>